<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RSA Demo</title>
</head>
<body>

<h2>RSA Demo</h2>

<p>Nhập p:</p>
<input type="number" id="p" value="17">

<p>Nhập q:</p>
<input type="number" id="q" value="11">

<p>Nhập e:</p>
<input type="number" id="e" value="27">

<br><br>
<button onclick="createKey()">Tạo khóa</button>

<p id="keyInfo"></p>

<hr>

<p>Nhập chữ cần mã hóa:</p>
<input type="text" id="plainText" value="Hello">
<br><br>
<button onclick="encryptText()">Mã hóa</button>

<p id="cipherText"></p>

<hr>

<p>Nhập cipher để giải mã:</p>
<input type="text" id="cipherInput">
<br><br>
<button onclick="decryptText()">Giải mã</button>

<p id="decryptedText"></p>

<script>

let n, phi, e, d;

// =======================
// MODULAR EXPONENTIATION
// =======================
function modPow(base, exp, mod) {
    let result = 1;
    base = base % mod;

    while (exp > 0) {
        if (exp % 2 === 1) {
            result = (result * base) % mod;
        }
        exp = Math.floor(exp / 2);
        base = (base * base) % mod;
    }
    return result;
}

// =======================
// TÌM d
// =======================
function findD(e, phi) {
    for (let i = 1; i < phi; i++) {
        if ((i * e) % phi === 1) {
            return i;
        }
    }
    return null;
}

// =======================
// TẠO KHÓA
// =======================
function createKey() {
    let p = parseInt(document.getElementById("p").value);
    let q = parseInt(document.getElementById("q").value);
    e = parseInt(document.getElementById("e").value);

    n = p * q;
    phi = (p - 1) * (q - 1);

    if (gcd(e, phi) !== 1) {
        alert("e không nguyên tố cùng nhau với phi(n)");
        return;
    }

    d = findD(e, phi);

    document.getElementById("keyInfo").innerHTML =
        "n = " + n +
        "<br>phi(n) = " + phi +
        "<br>d = " + d;
}

// =======================
// MÃ HÓA
// =======================
function encryptText() {
    let text = document.getElementById("plainText").value;
    let result = [];

    for (let i = 0; i < text.length; i++) {
        let m = text.charCodeAt(i);
        let c = modPow(m, e, n);
        result.push(c);
    }

    let cipher = result.join(" ");
    document.getElementById("cipherText").innerHTML = "Cipher: " + cipher;
    document.getElementById("cipherInput").value = cipher;
}

// =======================
// GIẢI MÃ
// =======================
function decryptText() {
    let cipher = document.getElementById("cipherInput").value;
    let parts = cipher.split(" ");
    let result = "";

    for (let i = 0; i < parts.length; i++) {
        let c = parseInt(parts[i]);
        let m = modPow(c, d, n);
        result += String.fromCharCode(m);
    }

    document.getElementById("decryptedText").innerHTML =
        "Giải mã: " + result;
}

// =======================
// GCD
// =======================
function gcd(a, b) {
    while (b !== 0) {
        let temp = b;
        b = a % b;
        a = temp;
    }
    return a;
}

</script>

</body>
    </html>
    

<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>RSA Demo</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    padding:20px;
}

.container{
    max-width:600px;
    margin:auto;
    background:white;
    padding:25px;
    border-radius:10px;
    box-shadow:0 4px 15px rgba(0,0,0,0.1);
}

h2{
    text-align:center;
    margin-bottom:20px;
}

label{
    font-weight:bold;
}

input{
    width:100%;
    padding:10px;
    margin-top:5px;
    margin-bottom:15px;
    border:1px solid #ccc;
    border-radius:6px;
    font-size:14px;
}

button{
    width:100%;
    padding:12px;
    background:#2d7dd2;
    color:white;
    border:none;
    border-radius:6px;
    font-size:15px;
    cursor:pointer;
    transition:0.3s;
}

button:hover{
    background:#1c5fa8;
}

.result{
    background:#eef3f9;
    padding:10px;
    border-radius:6px;
    margin-top:10px;
    font-weight:bold;
}
hr{
    margin:25px 0;
}
</style>
</head>

<body>

<div class="container">

<h2>RSA Demo (BigInt)</h2>

<label>Nhập p</label>
<input type="number" id="p" value="17">

<label>Nhập q</label>
<input type="number" id="q" value="11">

<label>Nhập e</label>
<input type="number" id="e" value="27">

<button onclick="createKey()">Tạo khóa</button>

<div id="keyInfo" class="result"></div>

<hr>

<label>Nhập chữ cần mã hóa</label>
<input type="text" id="plain" value="Hello">

<button onclick="encrypt()">Mã hóa</button>

<div id="cipher" class="result"></div>

<hr>

<label>Nhập cipher để giải mã</label>
<input type="text" id="cipherInput">

<button onclick="decrypt()">Giải mã</button>

<div id="result" class="result"></div>

</div>

<script>

let n, phi, e, d;

function modPow(base, exp, mod) {
    base = BigInt(base);
    exp = BigInt(exp);
    mod = BigInt(mod);

    let result = 1n;
    base = base % mod;

    while (exp > 0n) {
        if (exp % 2n === 1n)
            result = (result * base) % mod;

        exp = exp / 2n;
        base = (base * base) % mod;
    }
    return result;
}

function gcd(a, b) {
    while (b !== 0n) {
        let temp = b;
        b = a % b;
        a = temp;
    }
    return a;
}

function findD(e, phi) {
    for (let i = 1n; i < phi; i++) {
        if ((i * e) % phi === 1n)
            return i;
    }
    return null;
}

function createKey() {
    let p = BigInt(document.getElementById("p").value);
    let q = BigInt(document.getElementById("q").value);
    e = BigInt(document.getElementById("e").value);

    n = p * q;
    phi = (p - 1n) * (q - 1n);

    if (gcd(e, phi) !== 1n) {
        alert("e không nguyên tố cùng nhau với phi(n)");
        return;
    }

    d = findD(e, phi);

    document.getElementById("keyInfo").innerHTML =
        "n = " + n +
        "<br>φ(n) = " + phi +
        "<br>d = " + d;
}

function encrypt() {
    let text = document.getElementById("plain").value;
    let result = [];

    for (let i = 0; i < text.length; i++) {
        let m = BigInt(text.charCodeAt(i));
        let c = modPow(m, e, n);
        result.push(c.toString());
    }

    let cipher = result.join(" ");
    document.getElementById("cipher").innerHTML = "Cipher: " + cipher;
    document.getElementById("cipherInput").value = cipher;
}

function decrypt() {
    let cipher = document.getElementById("cipherInput").value;
    let parts = cipher.split(" ");
    let result = "";

    for (let part of parts) {
        let c = BigInt(part);
        let m = modPow(c, d, n);
        result += String.fromCharCode(Number(m));
    }

    document.getElementById("result").innerHTML =
        "Giải mã: " + result;
}

</script>

</body>
</html>
